<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is 17717 -->

<title>Deploy Rails Apps with Passenger and NGINX - Debian</title>
<style type='text/css'>
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleKeywords msdt:dt="string">Ruby, Rails, NGINX</mso:ArticleKeywords>
<mso:Reference msdt:dt="string">https://www.digitalocean.com/community/tutorials/how-to-deploy-a-rails-app-with-passenger-and-nginx-on-ubuntu-14-04, https://www.digitalocean.com/community/tutorials/how-to-deploy-a-rails-app-with-passenger-and-nginx-on-ubuntu-14-04</mso:Reference>
<mso:LinuxDistributions msdt:dt="string">;#Debian;#</mso:LinuxDistributions>
<mso:ArticlePriority msdt:dt="string">2</mso:ArticlePriority>
<mso:RequestNotes msdt:dt="string">Prereqs - 'Initial Server Setup,' FQDN pointing to server. Merge distros to forks if steps are identical across the fork. Skip all content until step 4 (Install Ruby), since those are covered in the prereqs, and its assumed that they can look at other instructions to actually buy a server. Link to Apache version 'Deploy Rails Apps with Passenger and Apache.' Use notes on Cent/Fedora article, but keep formatting and content of Ubuntu article.</mso:RequestNotes>
<mso:Difficulty msdt:dt="string">2</mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:ArticleID msdt:dt="string">17717</mso:ArticleID>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
<mso:Collapsed msdt:dt="string"></mso:Collapsed>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:ArticleStatus msdt:dt="string">Edited and needs revision</mso:ArticleStatus>


<mso:Sample msdt:dt="string">z</mso:Sample>
<mso:DeliveryTarget msdt:dt="string">Phase 1</mso:DeliveryTarget>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:PrereqOrdering msdt:dt="string">2</mso:PrereqOrdering>
<mso:AssignedTo1 msdt:dt="string">12</mso:AssignedTo1>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1 msdt:dt="string">Tom Taylor</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1>
<mso:Week msdt:dt="string">5.00000000000000</mso:Week>
<mso:ReviewComments msdt:dt="string">8/12 cj: This doc looks rough and unfinished... Please revise using 17715 or 17716 as a guide.
8/19 cj: Please revise using EDITED verison of 17715 or 17716. Prerequisites section is incorrect. Please see Gary for help.</mso:ReviewComments>
<mso:Dependencies msdt:dt="string"></mso:Dependencies>
<mso:TestComments msdt:dt="string"></mso:TestComments>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_ReviewedBy msdt:dt="string">Carla  Johnson</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_ReviewedBy>
<mso:ReviewedBy msdt:dt="string">41</mso:ReviewedBy>
<mso:PercentResearch msdt:dt="string">0.250000000000000</mso:PercentResearch>
<mso:PercentWriting msdt:dt="string">0.750000000000000</mso:PercentWriting>
<mso:HoursDraftingEstimated msdt:dt="string">3.00000000000000</mso:HoursDraftingEstimated>
<mso:HoursDraftingActual msdt:dt="string">3.00000000000000</mso:HoursDraftingActual>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>

<!--Please make sure that all variables use the proper formatting (<em> and <u>) and have a descriptive name such as "yourapplication" for an example application. cj --><!--Fixed-->
<p>Setting up Rails Apps with Passenger and Nginx in Debian, Ruby, Rails, Nginx</p>
 
    <h1>Deploy Rails Apps with Passenger and Nginx - Debian</h1>
    <p><strong>Difficulty</strong>: <em>2</em></p>
    <p><strong>Time</strong>: <em>30 minutes</em></p>
<p>Rails enables web developers to rapidly build quality applications, while Nginx is a lightweight, high-performance web server. In this article you'll learn to deploy a Rails application on an Nginx web server using the simple and powerful features of Phusion Passenger. These tasks assume that you have <code>sudo</code> privileges.</p>
<p>To set up your Ubuntu server, refer to <a href="17325 - Initial Server Setup - Debian"> Initial Server Setup - Debian</a>. Ensure that the fully qualified domain name (FQDN) points to the server. After you set up the server, you need to <a href="17538 - Install Ruby on Rails using RVM - Debian">install Ruby on Rails using RVM</a>.You can also refer to <a href ="17722 - Deploy Rails Apps with Passenger and Apache - Debian"> Deploy Rails Apps with Passenger and Apache - Debian</a>.</p>
<h2>Install Nginx and Passenger</h2>
   <ol>
     <li>Update the repositories, and install the dependencies for Ruby and Nginx.
            
          <div class='hacker'>sudo apt-get update</div>
     <div class='hacker'>sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev</div>
      </li>
      
        <li>Add the <code>gpg</code> key, and install the Phusion Passenger.
          <div class='hacker'>gpg --keyserver keyserver.debian.com --recv-keys 561F9B9CAC40B2F7    </div>
    <div class='hacker'>gpg --armor --export 561F9B9CAC40B2F7 | sudo apt-key add -
sudo apt-get install apt-transport-https    </div>
     </li>
        <li>Add the Passenger repository in the source list.
            <div class='hacker'>sudo sh -c "echo 'deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main' >> /etc/apt/sources.list.d/passenger.list"</div>
      <div class='hacker'>sudo chown root: /etc/apt/sources.list.d/passenger.list    </div>
    <div class='hacker'>sudo chmod 600 /etc/apt/sources.list.d/passenger.list    </div>
    <div class='hacker'>sudo apt-get update    </div>
        </li>
    
     <li>Install Nginx and Passenger.
        <div class='hacker'>sudo apt-get install nginx-full passenger    </div>
    </li>
	<li>For  language, select <code>Ruby</code>, and then press the <strong>Enter</strong> key.
          <div class='hacker'>Use &lt;space&gt; to select. If the menu doesn't display correctly, ensure that your terminal supports UTF-8.
      <ul>
        <li>Ruby</li>
          <li>Python</li>
            <li>Node.js</li>
          <li>Meteor</li>
        </ul>
</div>
</li>
<li>Select  <code>1</code> and press the <strong>Enter</strong> key to continue. This action downloads, compiles, and installs the Nginx files with Passenger support.
   <div class='hacker'>1. Yes: download, compile and install Nginx for me.(recommended)
       <br /> 
       The easiest way to get started. A stock NGINX 1.4.4 with Passenger support, but with no other additional third party modules, will be installed for you to a directory of your choice.</div>

</li></ol>
<h2>Set up a test Rails application</h2>
		<ol>
	
    <li>Create a directory.
      <div class='hacker'>sudo mkdir -p  <em><u>/var/www</u></em>    </div>
    </li>
	  <li>Move to the <code>www</code> directory, and create a Rails application.
        <div class='hacker'>cd  <em><u>/var/www</u></em></div>
      <div class='hacker'>rails new <em><u>SampleApp</u></em></div>  
      <div class='hacker'>cd <em><u>SampleApp</u></em></div>
	  </li>
   <li> Create sample resources.
      <div class='hacker'>rails generate scaffold Task title:string note:text</div>
	  <div class='hacker'>rake db:migrate RAILS_ENV=development</div>
	  </li>
    <li> Test the application by running the following command in application directory:
      <div class='hacker'>rails s --bind=<em><u>Public-IP</u></em></div> 
    </li>
      </ol>
	  <h2>Configure Nginx</h2><ol>
     <li>Open the  <span class="hacker"><code>nginx.conf</code></span> configuration file.
<div class='hacker'>sudo vim /etc/nginx/nginx.conf</div></li>
     <li>
      Uncomment the following line:
    
            <div class='hacker'>
            passenger_root /usr/lib/ruby/vendor_ruby/phusion_passenger/locations.ini;<br/>
passenger_ruby /home/deploy/.rbenv/shims/ruby; # If you use rbenv   
            </div>
        </li>
        <li>Save and exit.
          <div class ="hacker">:wq</div></li>
          <li>Restart the Nginx service.
            <div class='hacker'>sudo service nginx restart</div>
          </li>
       
        <li>Configure the Nginx host by opening <code>/etc/nginx/sites-enabled/default </code>in your text editor and replacing the file's contents with the following:
          <div class='hacker'>
            server {<br/>
            listen 80 default_server;<br/>
            listen [::]:80 default_server ipv6only=on;<br/>
            
            server_name <em><u>www.coolexample.com</u></em>; // Replace coolexample.com witch FQDN or Public-IP<br/>
            passenger_enabled on;<br/>
            rails_env    production;<br/>
            root         <em><u>/var/www/SampleApp</u></em>/public; // Your rails application's path<br/>
            <br/>
            # redirect server error pages to the static page /50x.html<br/>
            error_page   500 502 503 504  /50x.html;<br/>
            location = /50x.html {<br/>
            root   html;<br/>
            }<br/>
            
          </div>
        </li>  
        <!--Save and close the file? cj --><!--fixed-->   
	  <li>Save and exit.
	    <div class="hacker">:wq</div></li>
        <li>Restart the Nginx service.
            <div class='hacker'>sudo service nginx restart</div>
        </li></ol>
<h2>Conclusion</h2>
    In this article, you deployed a Rails application using Nginx and Passenger.<!--What might the user do next? cj --><!--Changed from "Next step" to "Conclusion"-->
</body>
</html>