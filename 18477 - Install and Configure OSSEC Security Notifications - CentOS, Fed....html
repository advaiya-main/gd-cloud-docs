<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Install and Configure OSSEC Security Notifications - CentOS, Fedora</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <style type="text/css">
    div.hacker {
        background-color: #666;
        border: 1px solid #ccc;
        color: #fff;
        font-family: "Lucida Console", "Courier New", Courier, fixed;
        font-size: 95%;
        line-height: 160%;
        margin-bottom: 1.5em;
        padding: 10px;
    }
    
    p.note {
        background-color: #ffffe6;
        border: 1px solid #eee;
        color: #666;
        padding: .8em 1.6em;
        margin: 15px 0;
    }
    
    .warning {
        border: 1px #d25100 solid;
        padding: .5em 1em .5em 4em;
        margin: 10px 20px 15px 20px;
        background-image: url('@{help-img-path}/img_warning.gif');
        background-repeat: no-repeat;
        background-position: left top;
        background-color: #ededed;
        -moz-border-radius: 0.8em;
        -webkit-border-radius: 0.8em;
        /* -moz-border-bottom-radius: 0;9 */
        -webkit-border-bottom-radius: 0;
        padding-top: 14px;
        padding-bottom: 15px;
    }
	.red-text{
		color:#FF8080;
	}
	.command{
		font-family: 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace;
	}
    </style>
</head>
<body>
	<p>Setting up OSSEC security notifications, Security, Monitoring</p>
	<h1>Install and Configure OSSEC Security Notifications - CentOS, Fedora</h1>
	<p><strong>Difficulty: </strong> 2</p>
	<p><strong>Time: </strong> 45 Minutes</p>
	<p>OSSEC is an open-source, host-based intrusion detection system. It performs log integrity checking, analysis, rootkit detection, Windows registry monitoring, active response and time based alerting. It can monitor one or more servers and can be configured to give real time alerts. This article explains installation of OSSEC security notifications on  CentOS and Fedora.</p>
	<p class="note">
		You will need access to sudo privileges to complete all steps.
	</p>
	<h2>Prerequisites </h2>
	<ul>
		<li>If you want to send mails from a local server you need to install Postfix. Please refer <a href="17425 - Install and Configure Postfix - CentOS">Install and Configure Postfix - CentOS</a>.</li>
	</ul>
	<h2>Prepare the System</h2>
	<ol>
		
		<li>
			Update the server using following command.
		<div class="hacker">sudo yum update</div>
		</li>
		<li>
		Install following packages.
		<div class="hacker">
				sudo yum groupinstall 'Development Tools' <br/>
				sudo yum install inotify-tools
		</div>
		</li>
	</ol>
	<h2>Download OSSEC and Verify the package</h2>
	You will need to download OSSEC tarball and a file with its cryptographic checksum to verify you are installing a valid software. We will generate MD5 and SHA1 checksum and compare with those in checksum file.
	
	<ol>
	
		
		<li>
		Download OSSEC with following command.
			<div class="hacker">sudo wget -U ossec http://www.ossec.net/files/ossec-hids-2.8.1.tar.gz</div>
			And for checksum file use following command.
			<div class="hacker">sudo wget -U ossec http://www.ossec.net/files/ossec-hids-2.8.1-checksum.txt</div>
		</li>
		<li>
			Verify the checksum with <code>cat</code> command.
			<div class="hacker">cat ossec-hids-2.8.1-checksum.txt</div>
			You will get:
			<div class="hacker">
				MD5(ossec-hids-2.8.1.tar.gz)= c2ffd25180f760e366ab16eeb82ae382<br/>
				SHA1(ossec-hids-2.8.1.tar.gz)= 0ecf1df09558dc8bb4b6f65e1fb2ca7a7df9817c
			</div>
		</li>
		<li>
			Generate the MD5sum of tarball.
			<div class="hacker">md5sum ossec-hids-2.8.1.tar.gz</div>
			You will get:
			<div class="hacker">c2ffd25180f760e366ab16eeb82ae382  ossec-hids-2.8.1.tar.gz</div>
			This should match with the MD5 checksum in file. Same will go for SHA1 as shown
			<div class="hacker">sha1sum  ossec-hids-2.8.1.tar.gz</div>
			It should give output as:
			<div class="hacker">0ecf1df09558dc8bb4b6f65e1fb2ca7a7df9817c  ossec-hids-2.8.1.tar.gz</div>
			It should match with the SHA1 checksum from the file.
		</li>
	</ol>
	<h2>Install OSSEC</h2>
	You can install OSSEC in many mode including server, agent, local or hybrid mode. In this example it will be installed in local mode.
	<ol>
		<li>
			Expand the file with:
			<div class="hacker">sudo tar -zxf ossec-hids-2.8.1.tar.gz</div>
			<p>If you get an error for tar command type <code>yum install tar</code> to install <code>tar</code>.</p>
			Change the directory to the one we just expanded.
			<div class="hacker">cd ossec-hids-2.8.1</div>
			Initiate the installation with:
			<div class="hacker">sudo ./install.sh</div>
		</li>
		<li>
			It will prompt you to answer a few questions. First question will be to choose a language. You may choose your language as you want. To use default press <strong>Enter</strong>.
			
			<p>You will see this:</p>
			<div class="hacker">
				<pre>
				OSSEC HIDS v2.8 Installation Script - http://www.ossec.net
				
				 You are about to start the installation process of the OSSEC HIDS.
				 You must have a C compiler pre-installed in your system.
				 If you have any questions or comments, please send an e-mail
				 to dcid@ossec.net (or daniel.cid@gmail.com).

				  - System: Linux ubuntu 3.13.0-55-generic
				  - User: root
				  - Host: ubuntu


				  -- Press ENTER to continue or Ctrl-C to abort. -

				</pre>
			</div>
			Press <strong>Enter</strong> to continue.
		</li>
		<li>
			You will get the prompt for the kind of installation. So type <em><u>local</u></em> and press <strong>Enter</strong>. You will get:
			<div class="hacker">
				Choose where to install the OSSEC HIDS [/var/ossec]:
			</div>
			Accept default by pressing <strong>Enter</strong>.
		</li>
		<li>
			It will ask for email notification.
			<div class="hacker">
				Do you want e-mail notification? (y/n) [y]:
			</div>
		</li>
		<li>
			Press <strong>Enter</strong>; it will ask your email address where you want to receive notifications.
			<div class="hacker">
				What's your e-mail address? 
			</div>
		</li>
		<li>
			Type your email address. It will show.
			<div class="hacker">
				
				We found your SMTP server as: advaiya-com.mail.protection.outlook.com.<br/>
				- Do you want to use it? (y/n) [y]:
				
			</div>
			Press <strong>Enter </strong>unless you want to use some specific SMTP.
		</li>
		<li>
			<p>It will ask you about what checks it should perform. You can press <strong>Enter</strong> to accept default.</p>
			<ol>
				<li>
					Press <strong>Enter</strong> for integrity check daemon.
					<div class="hacker">
						
						Do you want to run the integrity check daemon? (y/n) [y]:<br/>
						- Running syscheck (integrity check daemon).
						
					</div>
				</li>
				<li>
					<p>To detect rootkit, press <strong>Enter</strong>.</p>
					<div class="hacker">
						
						Do you want to run the rootkit detection engine? (y/n) [y]:<br/>
						- Running rootcheck (rootkit detection).
						
					</div>
				</li>
				<li>
					<p>For Active response, press <strong>Enter</strong>.</p>
					<div class="hacker">

					Active response allows you to execute a specific command based on the events received.<br/>  
					Do you want to enable active response? (y/n) [y]:

					</div>
				</li>
				<li>
					<p>Press <strong>Enter</strong> for default firewall drop response. </p>
					<div class="hacker">

					Do you want to enable the firewall-drop response? (y/n) [y]:<br/>
					- firewall-drop enabled (local) for levels >= 6

					</div>
				</li>
			</ol>
		
		</li>
		<li>
				<p>
			In the next prompt it will ask you for more IP addresses but that's not necessary. List files to be monitored will be displayed. You can add more files after installation, so press <strong>Enter</strong>. It may take a few minutes to install.
			
			</p>
				On successful installation you will get 
		
			<div class="hacker">
				<pre>
					System is Redhat Linux.
					- Init script modified to start OSSEC HIDS during boot.

					- Configuration finished properly.

					- To start OSSEC HIDS:
					/var/ossec/bin/ossec-control start

					- To stop OSSEC HIDS:
					/var/ossec/bin/ossec-control stop

					- The configuration can be viewed or modified at /var/ossec/etc/ossec.conf


					Thanks for using the OSSEC HIDS.
					If you have any question, suggestion or if you find any bug,
					contact us at contact@ossec.net or using our public maillist at
					ossec-list@ossec.net
					( http://www.ossec.net/main/support/ ).

					More information can be found at http://www.ossec.net

					---  Press ENTER to finish (maybe more information below). ---

				</pre>
			</div>
			</li>
		
	</ol>
	<h2>Start OSSEC</h2>
	OSSEC is configured to start at boot but first time you will need to initiate it manually.
	<ol>
		<li>
			
			Current status can be checked with:
			<div class="hacker">sudo /var/ossec/bin/ossec-control status</div>
			You will get.
			<div class="hacker">
				
				ossec-monitord not running...<br/>
				ossec-logcollector not running...<br/>
				ossec-syscheckd not running...<br/>
				ossec-analysisd not running...<br/>
				ossec-maild not running...<br/>
				ossec-execd not running...<br/>
				
			</div>
		</li>
		<li>
			To start the OSSEC, type:
			<div class="hacker">
			sudo /var/ossec/bin/ossec-control start
			</div>
			Following will be displayed.
			<div class="hacker">
				Starting OSSEC HIDS v2.8 (by Trend Micro Inc.)...
				Started ossec-maild...<br/>
				Started ossec-execd...<br/>
				Started ossec-analysisd...<br/>
				Started ossec-logcollector...<br/>
				Started ossec-syscheckd...<br/>
				Started ossec-monitord...<br/>
				Completed.
			</div>
		</li>
		<li>
			Right after starting the OSSEC, you will get a mail as shown.
			<div class="hacker">
			<pre>
			OSSEC HIDS Notification.
			2015 Aug 17 02:16:34

			Received From: ubuntu->ossec-monitord
			Rule: 502 fired (level 3) -> "Ossec server started."
			Portion of the log(s):

			ossec: Ossec started.
			</pre>
			</div>
			You will get such emails whenever something it is configured to monitor happens.
		</li>
	</ol>
<h2>Update Main configuration file</h2>
The main configuration file is <code>/var/ossec/etc/ossec.conf</code>. This file is used to configure OSSEC for additional alerts, number of emails, directories to be monitored etc. 
<p class="note">
	Following steps are optional.
</p>
<ol>
	<li>
		 Open ossec.conf in any editor.
		 <div class="hacker">
			sudo vim /var/ossec/etc/ossec.conf
		 </div>
	</li>
	<li> Add following line in <code>&lt;global></code> tag.
		<div class="hacker">&lt;email_maxperhour><em><u>N</u></em>&lt;/email_maxperhour></div>
		final code block will look like:
		<div class="hacker">
			&lt;global><br/>
			&lt;email_notification>yes&lt;/email_notification><br/>
			&lt;email_to>email@coolexample.com&lt;/email_to><br/>
			&lt;smtp_server>mail.coolexample.com.&lt;/smtp_server><br/>
			&lt;email_from>ossec@ossec_server&lt;/email_from><br/>
			<em><u>&lt;email_maxperhour>N&lt;/email_maxperhour></u></em><br/>
			&lt;/global><br/>
		</div>
	</li>
	<li>
		Locate <code>&lt;syscheck></code> tag in same file. You can update frequency of system check by updating <code>&lt;frequency></code> tag here. Time duration is in seconds.
		<div class="hacker">
				&lt;syscheck><br/>
				&lt;!-- Frequency that syscheck is executed - default to every 22 hours --><br/>
				<em><u>&lt;frequency>79200&lt;/frequency></u></em><br/>
		</div>
	</li>
	<li>
		Add following line in same <code>&lt;syscheck></code> tag to add alert for new files as shown.
		<div class="hacker">
				
					&lt;syscheck><br/>
					&lt;!-- Frequency that syscheck is executed - default to every 22 hours --><br/>
					&lt;frequency>79200&lt;/frequency><br/>
					<em><u>&lt;alert_new_files>yes&lt;/alert_new_files></u></em><br/>
				
		</div>
		
	</li>
	<li>
		Locate to <code>&lt;directories></code> tag right after the <code>&lt;syscheck></code> and add <code>report_changes="yes" realtime="yes" </code> to each line to enable real time monitoring as shown.
		<div class="hacker">
				&lt;!-- Directories to check  (perform all possible verifications) --><br/>
				&lt;directories <em><u>report_changes="yes" realtime="yes" check_all="yes"</u></em>>/etc,/usr/bin,/usr/sbin&lt;/directories><br/>
				&lt;directories <em><u>report_changes="yes" realtime="yes" check_all="yes"</u></em>>/bin,/sbin&lt;/directories><br/>
		</div>
	</li>
	<li>
		Add following line to add <code>/home/user_name </code> and <code>/var/www/ </code> to be monitored.
		<div class="hacker">
			&lt;directories report_changes="yes" realtime="yes" restrict=".php|.js|.py|.sh|.html" check_all="yes">/home/user_name,/var/www&lt;/directories>
		</div>
		<code>restrict </code>setting tells only to monitor specified formats.
	</li>
	<li>
		Save and close the file by pressing <code>esc</code> then typing following characters following by pressing <strong>Enter</strong>.
		<div class="hacker">
			:wq
		</div>
	</li>
	</ol>
		
<h2>Add local rules</h2>
Next file to be modified resides in <code>/var/ossec/rules</code>. 
In this directory <code>ossec_rules.xml</code> contains OSSEC's default rule definitions and custom rules are added in <code>local_rules.xml</code>
Default rule definitions in <code>ossec_rules.xml</code> file are useful to look at. We can copy and modify them in local rules.
<p class="note">
Following steps are optional.
</p>
		
		<ol>   
			<li>
				Open <code>/var/ossec/rules/ossec_rules.xml</code> in any editor, locate rule <strong>554</strong> and copy it.
				<div class="hacker">
				 sudo vim /var/ossec/rules/ossec_rules.xml
				</div>
				Rule 554 looks like:
				<div class="hacker">
						&lt;rule id="554" level="0" overwrite="yes"><br/>
						&lt;category>ossec&lt;/category><br/>
						&lt;decoded_as>syscheck_new_entry&lt;/decoded_as><br/>
						&lt;description>File added to the system.&lt;/description><br/>
						&lt;group>syscheck,&lt;/group><br/>
						&lt;/rule><br/>
					
				</div>
			</li>
			<li>
				Close the file by pressing the <strong>Esc</strong> key and typing <strong>:wq</strong> followed by pressing the <strong>Enter</strong> key.
				<div class="hacker">
					:q!
				</div>
			</li>
			<li>
				Open <code>/var/ossec/rules/local_rules.xml</code> in any editor.
				<div class="hacker">
					sudo vim /var/ossec/rules/local_rules.xml
				</div>
			</li>
			<li>Add the rule 554 you copied from <code>ossec_rules.xml</code> and change level to <strong>7</strong> as shown.
				<div class="hacker">
						<em><u>&lt;rule id="554" level="7" overwrite="yes"></u></em><br/>
						&lt;category>ossec&lt;/category><br/>
						&lt;decoded_as>syscheck_new_entry&lt;/decoded_as><br/>
						&lt;description>File added to the system.&lt;/description><br/>
						&lt;group>syscheck,&lt;/group><br/>
						&lt;/rule><br/>
					
				</div>
			</li>
				<li>Save and close the file by pressing the <strong>Esc</strong> key and typing <strong>:wq</strong> followed by pressing the <strong>Enter</strong> key.
				<div class="hacker">
					:wq
				</div></li>
				<li>Restart the OSSEC:
                  <div class="hacker">
					sudo /var/ossec/bin/ossec-control restart
				</div>
				  <p>You will get a mail when it is restarted.</p>
			  </li>
		</ol>
	
	
		<h2>Trigger file changes</h2>
		<p>When you add any file in directory to be monitored by OSSEC or you update or delete a file, you should be getting alerts.
		It doesn't send real time notification for adding a file but only for modification or deletion. Alerts of file addition go after full system check which is handled by frequency check time in ossec.conf.
		</p>

	
	<h2>Next Step</h2>
	After following all these steps you will be able to set up OSSEC notifications. OSSEC can be configured to one or more servers, called agents. To explore how to monitor an OSSEC agent using OSSEC server please refer to <a href="19003 - Monitor OSSEC Agents Using an OSSEC Server - CentOS, Fedora">Monitor OSSEC Agents Using an OSSEC Server - CentOS, Fedora</a>
	</body>
</html>
