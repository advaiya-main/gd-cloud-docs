<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head> 


<title>00030 - Install and configure Ghost with NGINX – Debian</title>
<style type="text/css">
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}

</style>


<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:ArticleID msdt:dt="string">00030</mso:ArticleID>
<mso:ArticleKeywords msdt:dt="string"></mso:ArticleKeywords>
<mso:Complexity msdt:dt="string"></mso:Complexity>
<mso:Reference msdt:dt="string">https://ghost.org/forum/installation/147-setup-ghost-with-nginx-on-debian/, https://ghost.org/forum/installation/147-setup-ghost-with-nginx-on-debian/</mso:Reference>
<mso:Week msdt:dt="string">7.00000000000000</mso:Week>
<mso:LinuxDistributions msdt:dt="string">;#Debian;#</mso:LinuxDistributions>
<mso:ReviewComments msdt:dt="string"></mso:ReviewComments>
<mso:PrereqOrdering msdt:dt="string">0</mso:PrereqOrdering>
<mso:ArticleStatus msdt:dt="string">Not started</mso:ArticleStatus>
<mso:Dependencies msdt:dt="string"></mso:Dependencies>
<mso:ArticlePriority msdt:dt="string"></mso:ArticlePriority>
<mso:AssignedTo1 msdt:dt="string">12</mso:AssignedTo1>
<mso:DeliveryTarget msdt:dt="string">Phase 2</mso:DeliveryTarget>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1 msdt:dt="string">Tom Taylor</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_AssignedTo1>
<mso:EditScore msdt:dt="string"></mso:EditScore>
<mso:RequestNotes msdt:dt="string"></mso:RequestNotes>
<mso:TestComments msdt:dt="string"></mso:TestComments>
<mso:Difficulty msdt:dt="string"></mso:Difficulty>
<mso:ForkSplit msdt:dt="string"></mso:ForkSplit>
<mso:UnsupportedFeatures msdt:dt="string"></mso:UnsupportedFeatures>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>


<p>Install and configure Ghost with NGINX - Debian, CMS, Ghost, NGINX</p>
<h1>Install and configure Ghost with NGINX - Debian</h1>
        
  <p><strong>Difficulty</strong>: <em>2</em><br/>
  <strong>Time</strong>: <em>1.0 hrs</em></p>
		
    <p>Ghost is a simple blogging platform that is fast and easy to set up and provides good customization options. This article  will help you  to set up a Ghost blogging platform with NGINX on Debian platform.</p> 
	<p class="note">These procedures assume that the user has sudo privileges.</p> 
	
	<h2>Prepare the machine</h2>
		 <ol>
		 <li>Update the Debian server.
		   <div class='hacker'>sudo apt-get update</div>
		 </li>
		 <li>Install the additional dependencies. (When prompted for confirmation during installation, enter <strong>Y</strong>.)
		   <div class='hacker'>sudo apt-get install unzip</div>
		 <div class='hacker'>sudo apt-get install git-core curl build-essential openssl libssl-dev</div>
		 </li>
		 <li>Download the <code>node.js</code> source.
		   <div class='hacker'>cd /tmp</div>
		 <div class='hacker'>git clone https://github.com/joyent/node.git</div>
		 </li>
		 <li>Select the appropriate version from the list of provided version numbers. (In this example, version v0.12.7 is installed.)
		   <div class='hacker'>cd node</div>
		  <div class='hacker'>git tag</div>
		  <div class='hacker'>git checkout v0.12.7</div>
		  </li>
		  <li>Compile <code>node.js</code>.
			<div class='hacker'>sudo ./configure &amp;&amp; sudo make &amp;&amp; sudo make install</div>
		 </li>
		 <li>Check the version numbers to ensure successful installations. Also ensure that path variables are configured properly.<!--Is this a necessary step? What does the user do with the version information? cj --> <!-- This is done to ensure the successful installation and also to check that all path variables are working correctly.--> 
		 <div class='hacker'>node -v</div>
		 <div class='hacker'>npm –v</div>
		 </li>
		 </ol>
		
		
		 <h2>Install Ghost</h2>
		 <ol>  
		 <li>Create new directory for Ghost.
		 <div class='hacker'>sudo mkdir /home/ghost</div></li>
		 <li>Move to the new directory.
		 <div class='hacker'>cd /home/ghost</div></li>
		 <li>Download  <code>Ghost</code> application.
		  <div class='hacker'>sudo wget https://ghost.org/zip/ghost-latest.zip</div>
		   <div class='hacker'>sudo unzip ghost-latest.zip</div>
		 </li>
		   <li>Install <code>npm.</code>
			 <div class='hacker'>sudo npm install --production</div>
		 </li>
		 <li>Prepare the <code>config</code> file for Ghost using the sample configuration file.
		 <div class='hacker'>sudo cp config.example.js config.js</div>
		 </li>
		  <li>Open the <code>config.js</code> file for editing. 
			<div class='hacker'>sudo vim config.js</div>
		 </li>
		  <li>Locate the following code in the file, and update the URL and host values with appropriate IP address. (URL and host IP address need to be modified with your settings.)
			<div class='hacker'> 
		 <pre>
	    production: {
        url: 'http://<em><u>Your IP Address</u></em>',
        mail: {},
        database: {
            client: 'sqlite3',
            connection: {
                filename: path.join(__dirname, '/content/data/ghost.db')
            },
            debug: false
        },

        server: {
            // Host to be passed to node's `net.Server#listen()`
            host: '<em><u>Your IP Address</u></em>',
            // Port to be passed to node's `net.Server#listen()`, for iisnode set this to `process.env.PORT`
            port: '2368'
        }
     }
</pre>
			 </div>
			 </li>
			 
			<li>Start Ghost (production environment).
			<div class='hacker'>sudo npm start --production</div>
			The default port used by Ghost is 127.0.0.1:2368.
			<p>When  starting, Ghost displays the message "Your blog is now available on <code> http://<em><u>provided URL</u></em>.</code>&quot;
			</p><br/></li>
			</ol>
  <h2>Configure to run Ghost forever</h2>
			<ol>
			 <li>Configure the tool <code>forever</code> as the node daemon tool.
			   <div class='hacker'>sudo npm install -g forever</div>
			 </li>
			 <li>Start the Ghost server.
			   <div class='hacker'>sudo NODE_ENV=production forever start index.js</div>
			 Upon successful start, the Ghost blog is available on the browser as <strong>http://<em><u>Your IP Address:2368/</u></em></strong>. (Replace the given IP address with the public IP address.)
			   <br />
			   <img src='images/00030- GhostOnBroowser.png' alt='00030- GhostOnBroowser.png'/>
			 </li>
			 <li>Stop the server.
			   <div class='hacker'>sudo forever list</div>
			  <div class='hacker'>sudo forever stop 0 # if of Ghost process</div>
			  <p>or</p>
			   <div class='hacker'>sudo forever stopall</div>
			 </li>
			 </ol>
			 
<h2>Set up NGINX and Ghost</h2>
             <ol>
			 <li>Install NGINX.
			   <div class='hacker'>sudo apt-get install nginx</div>
			 </li>
			 <li>Create a new Ghost configuration file and open it for editing. 
			 <div class='hacker'>sudo vim /etc/nginx/nginx.conf</div>
			 </li>
			 <li>Put the following code in the file: <!--Replacing it with what? cj --><!--Updated accordingly. VS-->
			   <div class='hacker'>
			 <pre>
user www-data;
worker_processes 4;
pid /run/nginx.pid;

events {
    worker_connections 768;
    # multi_accept on;
}
http {

    ##
    # Basic Settings
    ##

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    # server_tokens off;
    # server_names_hash_bucket_size 64;
    # server_name_in_redirect off;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ##
    # Logging Settings
    ##

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    ##
    # Gzip Settings
    ##

    gzip on;
    gzip_disable "msie6";

    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/      xml application/xml+rss text/javascript;

    ##
    # Virtual Host Configs
    ##

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
</pre>
			 </div>
			 </li>
			 <li>Save and exit the editor by pressing <strong>ESC</strong> key and then <strong>:wq</strong>.</li>
				
			 <li>Create the Ghost configuration file and open it for editing.
			 <div class='hacker'>sudo vim /etc/nginx/sites-enabled/ghost
			 </div></li>
			 <li>Put the following code in the configuration file:
			 <div class='hacker'>
			 <pre>
server {
    listen         80;
    server_name <em><u>Your IP Address;</u></em>
    root ~;
    index index.php;

    if ($http_host != "<em><u>Your IP Address</u></em>") {
         rewrite ^ http://<em><u>Your IP Address or domain name</u></em>request_uri permanent;
    }

    location / {
        proxy_set_header X-Real-IP  $remote_addr;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header Host $host;
        proxy_pass http://127.0.0.1:2368;
    }

    location ~* \.(?:ico|css|js|gif|jpe?g|png|ttf|woff)$ {
        access_log off;
        expires 30d;
        add_header Pragma public;
        add_header Cache-Control "public, mustrevalidate, proxy-revalidate";
        proxy_pass http://127.0.0.1:2368;
    }

    location = /robots.txt { access_log off; log_not_found off; }
    location = /favicon.ico { access_log off; log_not_found off; }

    location ~ /\.ht {
            deny all;
    }
}

</pre>
			 </div>
			 </li>
			 <li>Save and exit by pressing <strong>Esc</strong> and <strong>:wq</strong></li>
			 <li>Restart  NGINX.
			   <div class='hacker'>sudo /etc/init.d/nginx start</div>
			 </li>
			 <li>Open the broswer on your local system, and type-in the domain name provided for hosting the Ghost blog as URL. The Ghost blog should be available via the specified URL. 
			<br/>	
			<p><code>http://<em><u>Your domain name or IP Address:2368/</u></em> </code></p>
			 </li>
			 </ol>
            
    <h2>Next Steps</h2><!--This section needs to follow the editorial guidelines. It needs to "Provide a brief synopsis of what the user just completed;  Provide direction for the user to complete a related task (For help determining an appropriate link for another task, use your discretion/expertise." cj -->
	<!-- Updated the conclusion accordingly-->
<p>In this article, you learned the steps to install and configure Ghost with NGINX on Debian. The Ghost blogging platform, with its ease of deployment and use, can help individuals and organizations setup and extend their content management infrastructure. For an optimized performance, you can host mulitple Ghost blogs on a single server. For detailed steps, see <a href="18319 - Serve Multiple Ghost Blogs on One server Using NGINX - Ubuntu, Debian">Serve Multiple Ghost Blogs on One server Using NGINX - Ubuntu, Debian</a>
</p>   
</body>
</html>